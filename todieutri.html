








<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>NỘI TRÚ - T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - TAHT&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - N&#x1ED9;i tr&#xFA;</title>

    <link rel="icon" href="https://tamanhhospital.vn/wp-content/uploads/2021/02/favicon-tam-anh1.png" sizes="32x32">
    <link rel="icon" href="https://tamanhhospital.vn/wp-content/uploads/2021/02/favicon-tam-anh1.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://tamanhhospital.vn/wp-content/uploads/2021/02/favicon-tam-anh1.png">
    <meta name="msapplication-TileImage" content="https://tamanhhospital.vn/wp-content/uploads/2021/02/favicon-tam-anh1.png">

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/fontawesome-free/css/all.min.css" />

    <link rel="stylesheet" href="/css/font-awesome-4.7.0/css/font-awesome.css" />


    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css" />
    <!-- iCheck -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/icheck-bootstrap/icheck-bootstrap.min.css" />
    <!-- JQVMap -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/jqvmap/jqvmap.min.css" />
    <!-- Theme style -->
    <link rel="stylesheet" href="/themes/TamAnh/dist/css/adminlte.min.css" />
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/overlayScrollbars/css/OverlayScrollbars.min.css" />
    <!-- Daterange picker -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/daterangepicker/daterangepicker.css" />
    <!-- summernote -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/summernote/summernote-bs4.min.css" />
    <!--Uploader-->
    <link rel="stylesheet" href="/themes/TamAnh/lib/fineuploader/fine-uploader.min.css">
    <!-- Toastr -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/toastr/toastr.min.css">

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="/themes/TamAnh/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">

    <link href="/themes/TamAnh/plugins/jquery-ui/jquery-ui.css" rel="stylesheet" />
    <!-- Custom site -->
    <link rel="stylesheet" href="/themes/TamAnh/css/site.css">


    <link rel="stylesheet" href="/css/notification.css" />

    <link rel="stylesheet" href="/lib/EasyPlug/Css/jqpagination.css" />
    <link rel="stylesheet" href="/icon/icofont/css/icofont.css" />
    <link href="/themes/TamAnh/plugins/jquery-toast-plugin-master/src/jquery.toast.css" rel="stylesheet" />
    <link href="/themes/TamAnh/plugins/select2/select2.css" rel="stylesheet" />
    <link href="/themes/TamAnh/plugins/select2/select2-bootstrap.min.css" rel="stylesheet" />
    <link href="/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" rel="stylesheet" />
    <link href="/plugins/datatables-rowgroup/css/rowGroup.bootstrap4.min.css" rel="stylesheet" />
    <link href="/plugins/datatables-scroller/css/scroller.bootstrap4.min.css" rel="stylesheet" />
    <link href="/lib/jquery-freeze-table_plugins/css/ScrollTabla.css" rel="stylesheet" />
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>



    <!-- /.control-sidebar -->
    <!-- jQuery -->
    <script src="/themes/TamAnh/plugins/jquery/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="/themes/TamAnh/plugins/jquery-ui/jquery-ui.min.js"></script>

    <script src="/themes/TamAnh/plugins/jquery/jquery.ui.autocomplete.scroll.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <!-- Bootstrap 4 -->
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- daterangepicker -->
    <script src="/themes/TamAnh/plugins/moment/moment.min.js"></script>
    <script src="/themes/TamAnh/plugins/inputmask/jquery.inputmask.min.js"></script>
    <script src="/themes/TamAnh/plugins/daterangepicker/daterangepicker.js"></script>


    <!-- overlayScrollbars -->
    <script src="/themes/TamAnh/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->
    <script src="/themes/TamAnh/dist/js/adminlte.js"></script>
    <!--Uploader-->
    <script src="/themes/TamAnh/lib/fineuploader/jquery.fine-uploader.min.js" asp-append-version="true"></script>

    <!-- Toastr -->
    <script src="/themes/TamAnh/plugins/toastr/toastr.min.js"></script>

    <script src="/themes/TamAnh/plugins/sweetalert2/sweetalert2.min.js"></script>

    <script src="/themes/TamAnh/plugins/jquery-toast-plugin-master/src/jquery.toast.js"></script>

    <!-- Select2 -->
    <script src="/plugins/select2/js/select2.min.js"></script>

    <!-- DataTables  & Plugins -->

    <script src="/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="/plugins/datatables-scroller/js/dataTables.scroller.min.js"></script>

    <!-- cấu hình site -->


    <script src="/plugins/jquery-validation/jquery.validate.js"></script>
    <script src="/plugins/jquery-validation/additional-methods.min.js"></script>


    <script src="/lib/jquery.validate.unobtrusive.js"></script>
    <script src="/plugins/jquery-validation/localization/messages_vi.js"></script>
    <script src="/lib/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>
    <script src="/lib/Inputmask/dist/jquery.inputmask.js"></script>
    <script src="/lib/Inputmask/dist/bindings/inputmask.binding.js"></script>
    <script src="/lib/daterangepicker/moment.min.js"></script>
    <script src="/lib/daterangepicker/daterangepicker.js"></script>
    <script src="/lib/script/bootstrap-growl.min.js"></script>
    <script src="/lib/jquery-freeze-table/src/js/freeze-table.js"></script>
    <script src="/lib/jquery-freeze-table_plugins/js/jquery.CongelarFilaColumna.js"></script>
    <script src="/themes/TamAnhLogin/bootstrap4-editable/js/bootstrap-editable.js"></script>
    <script src="/lib/script/_script_include.js"></script>
    <script src="/lib/script/_script_include_form.js"></script>
    <!-- Theme style -->


</head>
<body class="layout-fixed layout-navbar-fixed layout-footer-fixed">

    <div class="wrapper">
        <!-- Navbar -->

        <nav class="main-header navbar navbar-expand navbar-white navbar-light p-0">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>

            </ul>
            <div class="ml-auto"><h4 style="margin: 0px"><b>TAH NỘI TRÚ - B&#xCA;&#x323;NH VI&#xCA;&#x323;N &#x110;A KHOA T&#xC2;M ANH TP. H&#x1ED2; CH&#xCD; MINH</b></h4></div>
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Navbar Search -->
                <!-- Messages Dropdown Menu -->
                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-user"></i>
                        <span>Tr&#x1EA7;n Qu&#x1ED1;c Ho&#xE0;i</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <div id="change-pin-chung-thu-so">
                            <a href="#" class="dropdown-item" data-style="ccs" data-key="change-pin-chung-thu-so" data-title="Đổi mật khẩu ký số" data-id="4108" data-action="Update" data-style="lg">
                                <i class="fas fa-key mr-2"></i> Đổi mật khẩu ký số
                            </a>
                            <script>
                                window["cc_change-pin-chung-thu-so"] = FEFrom("change-pin-chung-thu-so", "/sp-admin/change-pin-chung-thu-so");
                            

                            </script>
                            <style>
                                #form-change-pin-chung-thu-so .form-group {
                                    margin-bottom: 0.25rem;
                                }

                                #form-change-pin-chung-thu-so .card-sm {
                                    margin-bottom: 0.5rem;
                                }
                                #form-change-pin-chung-thu-so .card-sm .card-body {
                                    padding: 0.55rem;
                                }


                                    #form-change-pin-chung-thu-so .card-sm .card-footer {
                                    padding: 0.5rem 0.25rem;
                                }

                                #form-change-pin-chung-thu-so .control-label-sm {
                                    padding-top: calc(0.15rem + 1px);
                                    padding-bottom: calc(0.15rem + 1px);
                                }

                                #form-change-pin-chung-thu-so .card-sm .card-header {
                                    padding: 0.5rem 0.75rem;
                                }

                                #form-change-pin-chung-thu-so .ajax-form-body-sm {
                                    padding: 0.15rem 0.75rem !important;
                                }

                                #form-change-pin-chung-thu-so .customModal_content {
                                    padding: 0.5rem;
                                }

                                #form-change-pin-chung-thu-so .container-fluid-sm {
                                    padding-left: 0px;
                                    padding-right: 0px;
                                }

                                #form-change-pin-chung-thu-so .customModal .modal-header {
                                    padding: 0.25rem 0.75rem
                                }
                            </style>
                            <style>
                                #form-change-pin-chung-thu-so {
                                    z-index: 9999999998;
                                }

                                #form-change-pin-chung-thu-so_Close {
                                    z-index: 9999999999;
                                }

                           
                                .modal-ccs {
                                    max-width: 500px;
                                }

                                .modal-ccs .item-field > div {
                                    position:relative
                                }

                                .modal-ccs .item-field .toggle-password {
                                    position: absolute;
                                    top: 15px;
                                }

                                .modal-ccs .item-field  .error + .field-icon {
                                    position: absolute;
                                    top: 18px;
                                }

                                #form-change-pin-chung-thu-so_Close .modal-dialog {
                                    max-width: 400px;
                                }
                            </style>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="/Home/Login" class="dropdown-item dropdown-footer"><i class="fa fa-sign-out-alt"></i> Đăng xuất</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>

            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4" style="overflow-x: hidden">
            <!-- Brand Logo -->
            <div class="row text-center">
                <div class="col-12 mt-3">
                    <a href="https://tamanhhospital.vn"><img class="lazyload" alt="Bệnh viện đa khoa Tâm Anh" data-src="~/img/logo_desk.png" src="/img/logo_desk.png" width="60%"></a>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">


                <!-- SidebarSearch Form -->
                <div class="form-inline">
                    <div class="input-group" data-widget="sidebar-search">
                        <input class="form-control form-control-sidebar" type="search" placeholder="Tìm kiếm" aria-label="Search">
                        <div class="input-group-append">
                            <button class="btn btn-sidebar">
                                <i class="fas fa-search fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Menu -->


                <nav class="mt-2">


                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                                    <li class="nav-item">
                                        <a href="/hoso" class="nav-link ">
                                            <i class="fa far fa-address-book nav-icon"></i>
                                            <p>Xem b&#x1EC7;nh &#xE1;n</p>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://hsba.tahospital.vn/hosobenhan/chitiet" class="nav-link ">
                                            <i class="fa far fa-book nav-icon"></i>
                                            <p>H&#x1ED3; s&#x1A1; b&#x1EC7;nh &#xE1;n V2</p>
                                        </a>
                                    </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-adjust"></i>
                                        <p>
                                            &#x110;&#xE1;nh gi&#xE1; ban &#x111;&#x1EA7;u
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/VitualSigns/Index" class="nav-link ">
                                                            <i class="fa far fa-assistive-listening-systems nav-icon"></i>
                                                            <p>&#x110;&#xE1;nh gi&#xE1; l&#x1EA1;i </p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="/to-dieu-tri" class="nav-link active">
                                        <i class="nav-icon fas fa-file-zip-o"></i>
                                        <p>
                                            T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB;
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="display: block;">
                                                    <li class="nav-item">
                                                        <a href="/to-dieu-tri" class="nav-link active">
                                                            <i class="fa far fa-flask nav-icon"></i>
                                                            <p>T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - N&#x1ED9;i tr&#xFA;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/to-dieu-tri?type=2" class="nav-link ">
                                                            <i class="fa far fa-flask nav-icon"></i>
                                                            <p>T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - Ngo&#x1EA1;i tr&#xFA;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/to-dieu-tri?type=4" class="nav-link ">
                                                            <i class="fa far fa-flash nav-icon"></i>
                                                            <p>T&#x1EDD; &#x111;i&#x1EC1;u tr&#x1ECB; - C&#x1EA5;p c&#x1EE9;u</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/can-thiep-truong-khoa" class="nav-link ">
                                                            <i class="fa far fa-database nav-icon"></i>
                                                            <p>L&#xE3;nh &#x110;&#x1EA1;o Khoa</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-cube"></i>
                                        <p>
                                            Qu&#x1EA3;n l&#xFD; kh&#xE1;m ti&#x1EC1;n m&#xEA;
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/TienMe/TongQuan" class="nav-link ">
                                                            <i class="fa far fa-cogs nav-icon"></i>
                                                            <p>T&#x1ED5;ng quan</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/TienMe/dang-ky" class="nav-link ">
                                                            <i class="fa far fa-edit nav-icon"></i>
                                                            <p>&#x110;&#x103;ng k&#xFD;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/TienMe/DanhSach" class="nav-link ">
                                                            <i class="fa far fa-asterisk nav-icon"></i>
                                                            <p>Kh&#xE1;m t&#x1EA1;i gi&#x1B0;&#x1EDD;ng</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/TienMe/Index" class="nav-link ">
                                                            <i class="fa far fa-assistive-listening-systems nav-icon"></i>
                                                            <p>Kh&#xE1;m t&#x1EA1;i ph&#xF2;ng</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-hotel"></i>
                                        <p>
                                            Kh&#xE1;m chuy&#xEA;n khoa
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/KhamChuyenKhoa/dang-ky" class="nav-link ">
                                                            <i class="fa far fa-at nav-icon"></i>
                                                            <p>&#x110;&#x103;ng k&#xFD; kh&#xE1;m</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/KhamChuyenKhoa/DanhSach" class="nav-link ">
                                                            <i class="fa far fa-american-sign-language-interpreting nav-icon"></i>
                                                            <p>Danh s&#xE1;ch kh&#xE1;m</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-universal-access"></i>
                                        <p>
                                            Kh&#xE1;m h&#x1ED9;i ch&#x1EA9;n
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/KhamHoiChanDuyetMo" class="nav-link ">
                                                            <i class="fa far fa-registered nav-icon"></i>
                                                            <p>&#x110;&#x103;ng k&#xFD;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/KhamHoiChanDuyetMoDanhSach" class="nav-link ">
                                                            <i class="fa far fa-group nav-icon"></i>
                                                            <p>Danh s&#xE1;ch kh&#xE1;m</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-book"></i>
                                        <p>
                                            EMR - Danh S&#xE1;ch Phi&#x1EBF;u
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/DanhSachBenhNhan/Index" class="nav-link ">
                                                            <i class="fa far fa-address-book nav-icon"></i>
                                                            <p>Hi&#x1EC7;n di&#x1EC7;n - N&#x1ED9;i tr&#xFA;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/DanhSachBenhNhan/NgoaiTru" class="nav-link ">
                                                            <i class="fa far fa-address-book nav-icon"></i>
                                                            <p>Hi&#x1EC7;n di&#x1EC7;n - Ngo&#x1EA1;i tr&#xFA;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/DanhSachBenhNhan/CapCuu" class="nav-link ">
                                                            <i class="fa far fa-address-book nav-icon"></i>
                                                            <p>Hi&#x1EC7;n di&#x1EC7;n - C&#x1EA5;p c&#x1EE9;u</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/DanhSachBenhNhanKhamBenh/Index" class="nav-link ">
                                                            <i class="fa far fa-heart nav-icon"></i>
                                                            <p>Kh&#xE1;m b&#x1EC7;nh ngo&#x1EA1;i tr&#xFA;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/PhieuBanGiao/DanhSach" class="nav-link ">
                                                            <i class="fa far fa-history nav-icon"></i>
                                                            <p>L&#x1ECB;ch s&#x1EED; phi&#x1EBF;u</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/todieutri/quanlykhangsinh" class="nav-link ">
                                                            <i class="fa far fa-book nav-icon"></i>
                                                            <p>Qu&#x1EA3;n l&#xFD; phi&#x1EBF;u kh&#xE1;ng sinh</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-blind"></i>
                                        <p>
                                            X&#xE9;t nghi&#x1EC7;m vi khu&#x1EA9;n
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/sp-admin/xnnk-dmbenhpham" class="nav-link ">
                                                            <i class="fa far fa-bomb nav-icon"></i>
                                                            <p>Danh m&#x1EE5;c b&#x1EC7;nh ph&#x1EA9;m</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/sp-admin/xnnk-dmdichvu" class="nav-link ">
                                                            <i class="fa far fa-bookmark nav-icon"></i>
                                                            <p>Danh m&#x1EE5;c d&#x1ECB;ch v&#x1EE5;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/sp-admin/xnnk-dmkhoaphong-pid" class="nav-link ">
                                                            <i class="fa far fa-cubes nav-icon"></i>
                                                            <p>Danh m&#x1EE5;c khoa ph&#xF2;ng</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                                <li class="nav-item ">
                                    <a href="#" class="nav-link ">
                                        <i class="nav-icon fas fa-blind"></i>
                                        <p>
                                            &#x110;i&#x1EC1;u Tra NK B&#x1EC7;nh Vi&#x1EC7;n
                                                <i class="fas fa-angle-left right"></i>
                                        </p>
                                    </a>
                                        <ul class="nav nav-treeview" style="">
                                                    <li class="nav-item">
                                                        <a href="/nhiemkhuanbenhvien" class="nav-link ">
                                                            <i class="fa far fa-edit nav-icon"></i>
                                                            <p>&#x110;&#x103;ng k&#xFD;</p>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="/nhiemkhuanbenhvien/danhsach" class="nav-link ">
                                                            <i class="fa far fa-address-book nav-icon"></i>
                                                            <p>Danh s&#xE1;ch</p>
                                                        </a>
                                                    </li>
                                        </ul>

                                </li>
                    </ul>


                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>



        <div class="content-wrapper">




            <main role="main" class="content">
                <div class="container-fluid">
                    


<style>
    .main-header .navbar-white {
        display: none;
    }
</style>
<div class="row">
    <div class="col-lg-12" id="DanhSachBenhNhan">
        <div class="card card-outline card-info">
            <div class="card-header ui-sortable-handle">
                <h3 class="card-title">
                    <i class="fas fa-book mr-1"></i>
                    DANH SÁCH BỆNH NHÂN
                </h3>

            </div>
            <div class="card-body">
                <form id="form">
                    <div class="form-group row mb-1">
                        <div class="col-md-2">
                            <div class="form-group form-group-sm">
                                <label>Khoa</label>
                               
                                <select class="form-control form-control-sm select2" style="width:100%;" name="khoa" id="ddlKhoa" >
                                   
                                </select>
                                <script>
                                    if ('048' != '') {
                                        $('#ddlKhoa').val('048');
                                    }


                                </script>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group form-group-sm">
                                <label>Phòng</label>
                                <select class="form-control form-control-sm select2" id="ddlRoom" name="phong" style="width:100%">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label>Tên, Mã bệnh nhân</label>
                            <div class="input-group input-group-sm">
                                <input type="hidden" class="form-control" id="hdLoaiBn" name="loaibn"  />
                                <input type="text" class="form-control" name="mabn" placeholder="Tên, Mã bệnh nhân" />
                                <div class="input-group-append">
                                    <button id="btnsearch" name="btnsearch-searchTen" type="button" class="btn btn-info">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 d-flex">
                            <div class="form-check" style="    align-self: flex-end;">
                                <input type="hidden" class="form-control" value="0" name="tk" id="hdtk" />
                                <input type="hidden" class="form-control" value="0" name="cbAll" id="hdcbTaCa" />
                                <input class="form-check-input" type="checkbox" value="" id="cbTaCa">
                                <label class="form-check-label" for="cbTaCa">
                                    Tất cả
                                </label>
                            </div>

                        </div>
                    </div>
                </form>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="row">

                            <div class="col-6 col-lg-2">
                                <div class="info-box mb-1" data-id="0">
                                    <span>
                                        <img src="/img/tivi/hiendien.png">
                                    </span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Hiện Diện</span>
                                        <span class="info-box-number" id="countHienDien">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-2">
                                <div class="info-box mb-1" data-id="2">
                                    <span>
                                        <img src="/img/tivi/nhapvien.png">
                                    </span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Nhập Khoa</span>
                                        <span class="info-box-number" id="countNhapKhoa">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-2" data-id="5">
                                <div class="info-box mb-1">
                                    <span>
                                        <img src="/img/tivi/xuatvien.png">
                                    </span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Xuất Viện</span>
                                        <span class="info-box-number" id="countXuatVien">0</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6 col-lg-2">
                                <div class="info-box mb-1" data-id="3">
                                    <span><img src="/img/tivi/ChuyenKhoaTDT.png"></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Chuyển khoa</span>
                                        <span class="info-box-number" id="countChuyenKhoa">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-2">
                                <div class="info-box mb-1" data-id="4">
                                    <span><img src="/img/tivi/DaKham.png"></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Đã khám</span>
                                        <span class="info-box-number" id="countDaKham">0</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-2">
                                <div class="info-box mb-1" data-id="6">
                                    <span><img src="/img/tivi/ChuaKham.png"></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Chưa khám</span>
                                        <span class="info-box-number" id="countChuaKham">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        $('.info-box').click(function () {

                            var id = $(this).attr('data-id');
                            $('#hdtk').val(id);
                            LoadData($("#form"));
                        });
                    </script>
                    <style>
                        .info-box {
                            min-height: 40px;
                            padding: .3rem;
                        }

                        #DanhSachBenhNhan .info-box.active {
                            background-color: rgba(53, 158, 220, 0.5) !important;
                        }

                        #DanhSachBenhNhan .info-box {
                           
                            cursor: pointer;
                        }
                        #DanhSachBenhNhan .info-box span img {
                            width: 30px;
                            cursor:pointer;
                        }

                        #DanhSachBenhNhan .info-box .info-box-content {
                            width: 30px;
                            line-height: 1;
                        }

                    </style>
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-striped nowrap dataTable" style="width:100%" id="tblListData">
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="col-lg-12" id="LoadDetail">
        <div style="min-height:calc(100vh - 200px);">
            
<div id="ThongTinHanhChinh">


</div>



<div class="modal fade" id="modalcanhbaoi3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="z-index:9999999999" aria-hidden="true">
    <div class="modal-dialog modal-xxl">
        <div class="modal-content">
            <div class="modal-header">
                Thông báo
            </div>
            <div class="modal-body ">
                <iframe id="frameI3" width="100%" style="height: calc(100vh - 200px);" src="">
                </iframe>
            </div>
            <div class="modal-footer  text-center">

                <a class="btn btn-danger" data-dismiss="modal">Đóng</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalCanhbaoThuocChuyen" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="z-index:99999999;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Thông báo
            </div>
            <div class="modal-body ">
                <h5 class="txtMess">Phiếu đã được chuyển vui lòng chọn lại phiếu khác</h5>
            </div>
            <div class="modal-footer  text-center">

                <a class="btn btn-danger btnDongCanhbaoThuocChuyen">Đóng</a>
            </div>
        </div>
    </div>
</div>


<style>
    @media screen and (max-height:780px) {
        .dropdown-menu.show {
            top: 100% !important;
        }
    }

    #ThongTinHanhChinh .btn-chucnangcl .dropdown-menu.show {
        top: 100% !important;
        left: 30px !important;
    }

    .daterangepicker {
        z-index: 9999999999;
    }

    .messLuuY {
        white-space: pre-line;
    }
</style>
<script>
        $('.btn-hsba2').click(function(){
        
        LoadLinkHsba();
        });
       function LoadLinkHsba() {
            $.ajax({
                url: '/ToDieuTri/LoadLinkHsba',
                type: 'POST',
                data: {
                    code: $('#hdMabn').val()
                  
                }
            }).done(function (response) {
            
                window.open(response.data.link, '_blank');

            });
        }


        function mModalDanhSachThuocNgung(id) {
            return $(`<div class="modal fade" id="m${id}" style="background-color: #80808080;" tabindex="-1"  aria-hidden="true" data-toggle="modal" data-backdrop="static" data-keyboard="false">
                                                                        <div class="modal-dialog modal-xl" role="document">
                                                                            <div class="modal-content">
                                                                                <div class="modal-body customModal_content" style="height:80vh">
                                                                                            <div class="row">
                                                                                                  <div class="col-12 mb-2">
                                                                                                  <lable>Lý do ngưng thuốc</lable>
                                                                                                               <textarea class="speedtotext form-control form-control-sm" id="LyDoNgungThuoc" name="lydo" rows="2" style=""></textarea>
                                                                                                    </div>
                                                                                                    <div class="col-12 h-100">
                                                                                                                                <div id="${id}" data-template="ToDieuTri/NgungThuoc/_PopupSelectNgungThuoc" ></div>
                                                                                                </div>

                                                                                            </div>

                                                                                </div>
                                                                                       <div class="modal-footer justify-content-end" style="    z-index: 9999999;">
                                                                                   <button type="button" class="btn btn-cancel btn-primary btn-ngung" >Ngưng thuốc</button>
                                                                                            <button type="button" class="btn btn-cancel btn-danger btn-close" >Đóng</button>
                                                                              </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>`);
        }

        function viewSelectDanhSachThuocNgung() {


            let id = uuidv4();
            let m = mModalDanhSachThuocNgung(id);
            m.find('.btn-close').on('click',
                function () {
                    m.modal('hide');
                });
            m.find('.btn-ngung').on('click',
                function () {
                    $(this).attr('disabled', 'disabled');
                    let arr = [];
                    $('.cb-ngungthuoc').each(function () {
                        if (this.checked) {
                            arr.push($(this).val());
                        }

                    });


                     if ($('#LyDoNgungThuoc').val() == '') {
                        toastr.error('Vui lòng nhập lý do ngưng thuốc'); $(this).removeAttr('disabled');
                    }
                    else {


                        $.ajax({
                            url: '/todieutri/NgungThuoc/NgungThuoc',
                            type: 'POST',
                            data: {
                                id: arr,
                                iddienbien: $('#hdDienBienID').val(),
                                mmyy: $('#hdDienBienMmyy').val(),
                                lydo: $('#LyDoNgungThuoc').val(),
                                loaibn: $('#hdLoaiBn').val(),

                            }
                        }).done(function (response) {
                            console.log(response);
                            if (response.Status == 1) {
                                Toast('Thông báo', 'Ngưng thuốc thành công', 'success');
                                LoadDSNhomKhoaDienBien();
                                m.modal('hide');

                            } else {
                                Toast('Thông báo', 'Ngưng thuốc không thành công ' + response.Message, 'error')

                            }

                            $(this).removeAttr('disabled');
                        });
                    }



                });
            m.on('hidden.bs.modal',
                function (e) {

                    m.remove();
                });
            m.on('shown.bs.modal',
                function (e) {

                    let sProduct = FEFrom(id, "/todieutri/NgungThuoc", {
                        query: "?iddienbien=" + $('#hdDienBienID').val() + "&mmyy=" + $('#hdDienBienMmyy').val() + "&iddienbien_=" + $('#hdDienBienIDNgung').val() + "&mmyy_=" + $('#hdMMYYNgung').val(),
                        "listTemplate": "ToDieuTri/NgungThuoc/_PopupSelectNgungThuocListFilter"
                    });

                    sProduct.LoadLayout(function (obj) {

                        $('#' + obj.getID()).css('height', '100%');
                        $('#' + obj.getID() + "_Table").attr('style', "height:calc(" + ($('#' + obj.getID()).height() - $('#' + obj.getID() + ' .Layout_Filter').height()) + "px - 0rem)");
                        $('#' + obj.getID()).find('.freezeTable1').css("height", "100%");


                    });





                });
            m.modal('show');



        }







        $('.btn-printdienbien').click(function () {

            var arr = [];
            $('.cb-dienbien:checked').each(function () {
                let id = $(this).attr('data-id');
                let mmyy = $(this).attr('data-mmyy');
                arr.push(id + '|' + mmyy);
            });


            $('#hdCheckDienBien').val(arr.join(','));

            PrintDienBien();


        });
        $('.btn-printcls').click(function () {

            if ($('.cb-dienbien:checked').length > 1) {
                strMess = 'Vui lòng chọn 1 diễn biến';
                toastr.error(strMess);
                return;
            }
            if ($('.cb-dienbien:checked').length == 0) {
                strMess = 'Vui lòng chọn 1 diễn biến';
                toastr.error(strMess);
                return;
            }
            let idseq = $('.cb-dienbien:checked').eq(0).data('id');
            $('#modalCLS_' + idseq).modal('show');


        });
        function PrintDienBienCLSSelection(idseq) {
            let lstCLS = [];
            $('#modalCLS_' + idseq).find('input:checked').not('.AllCheck').each(function () {
                lstCLS.push(this.value);
            });
            PrintDienBienCLS(lstCLS.join(','),$('#modalCLS_' + idseq).attr('data-loaibn'));

        }
        function PrintDienBienCLS(ids, loaibn) {

            $.ajax({
                url: '/todieutri/dienbien/InDienBienCLS',
                type: 'POST',
                data: {
                    ids: ids,
                    id: $('#hdCheckDienBien').val(),
                    mabn: $('#hdMabn').val(),
                    mavaovien: $('#hdMaVV').val(),
                    maql: $('#hdMaQL').val(),
                    loaibn: loaibn,

                }
            }).done(function (response) {
                if (response.Status == 3) {
                    toastr.error(response.Message);
                    return;
                }
                PrintDienBienCLSPDF(response.Data.ids, loaibn);



            });

        }
        function PrintDienBienCLSPDF(ids, loaibn) {
            let newTab = window.open('/todieutri/DienBien/InChiTietDienBienCLS.pdf?id='
                + $('#hdCheckDienBien').val()
                + "&mabn=" + $('#hdMabn').val()
                + "&mavaovien=" + $('#hdMaVV').val()
                + "&maql=" + $('#hdMaQL').val()
                + "&loaibn=" + loaibn
                + "&ids=" + ids
                , '_blank');


        }

        function PrintDienBien() {

            var newTab = window.open('/todieutri/DienBien/PrintPDF?id='
                + $('#hdCheckDienBien').val()
                + "&mabn=" + $('#hdMabn').val()
                + "&mavaovien=" + $('#hdMaVV').val()
                + "&tungay=" + $('#DateFrom').val()
                + "&denngay=" + $('#DateTo').val()
                + "&maql=" + $('#hdMaQL').val()
                + "&idkhoa=" + $('#hdIDKHOA').val()
                + "&loaibn=" + $('#hdLoaiBn').val()
                , '_blank');


        }
        $('.btn-tienich').click(function () {
            var type = $(this).attr('data-type');
            var mabn = $(this).attr('data-mabn');
            if (type == 1) {

                viewSelectLichSuDuLieu();
            }
            else if (type == 2) {

                viewSelectLichSuKy();
            }


        });

        $('.btn-hethong').click(function () {
            var type = $(this).attr('data-type');
            var mabn = $(this).attr('data-mabn');
            if (type == 1) {

                viewSelectDanhMucVietTat();
            }



        });
        $('.btn-search-tdt').click(function () {
            //LoadDSNhomKhoaDienBien();
            LoadDSNhomKhoaDienBien();
        });
        $('.btn-chucnang').click(function () {
            var type = $(this).attr('data-type');
            var mabn = $(this).attr('data-mabn');
            if (type == 1) {

                LoadDutru(type);
            }
            else if (type == 2) {
                $('#modalTuTruc').modal({ backdrop: 'static', keyboard: false });
            }
            else if (type == 3) {
                if ($('#hdChuKy').val() == "True") {
                    toastr.error('Diễn biến đã ký xác nhận');
                }
                //else if ( $('#checkTongKet').val()=="1")
                //{
                //    toastr.error('Bệnh nhân đã tổng kết ra viện');
                //}

                else if ($('#hdDienBienID').val() == "" || $('#hdDienBienID').val() == "0") {
                    toastr.error('Vui lòng chọn diễn biến');
                }


                else {
                    LoadChiDinhDichVu();
                }

            }
            else if (type == 11) {
                if ($('#hdChuKy').val() == "True") {
                    toastr.error('Diễn biến đã ký xác nhận');
                }

                else if ($('#hdDienBienID').val() == "" || $('#hdDienBienID').val() == "0") {
                    toastr.error('Vui lòng chọn diễn biến');
                }
                else {
                    LoadChamSoc();
                }

            }
            else if (type == 12) {

                if ($('#hdChuKy').val() == "True") {
                    toastr.error('Diễn biến đã ký xác nhận');
                } else if ($('#hdDienBienID').val() == "" || $('#hdDienBienID').val() == "0") {
                    toastr.error('Vui lòng chọn diễn biến');
                } else {
                    LoadDinhDuong();
                }
            }
            else if (type == 14) {

                if ($('#hdDienBienID').val() == "0") {
                    toastr.error('Vui lòng chọn diễn biến');
                } else {
                    CopyToDieuTri()
                }
            }
            else if (type == 13) {



                if ($('#hdDienBienID').val() == '0' || $('#hdDienBienID').val() == '' ) {
                        toastr.error('Vui lòng chọn diễn biến'); $(this).removeAttr('disabled');
                }else{
                    viewSelectDanhSachThuocNgung();
                }

            }

            else if (type == 8) {
                LoadChiDinhTamUng();
            }
            else if (type == 9) {
                LoadUpdateDienBien();
            }

        });
        $('.btn-back').click(function () {

            $('#DanhSachBenhNhan').show();
            $('#ThongTinHanhChinh').hide();

        });

        function CopyToDieuTri() {

            $.ajax({
                url: '/ToDieuTri/CopyToDieuTri',
                type: 'POST',
                data: {
                    mmyy: $('#hdDienBienMmyy').val(),
                    idseq: $('#hdDienBienID').val(),

                }
            }).done(function (response) {

                LoadDSNhomKhoaDienBien();
            });
        }
        function BuildTableTamUng(obj, data) {
            $('#' + obj).DataTable({
                ordering: false,
                searching: false,
                paging: true,
                data: data,
                lengthChange: false,
                pagingType: "simple_numbers",
                info: false,
                language: {
                    "lengthMenu": "Hiển thị _MENU_ dòng trên 1 trang",
                    "zeroRecords": "Không có dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ trong _TOTAL_ dòng",
                    "infoEmpty": "Chưa có dữ liêu",
                    "infoFiltered": "(dữ liệu trong  _MAX_ )",
                    "paginate": {
                        "previous": "«", "next": "»"
                    }
                },
                scrollCollapse: true,
                destroy: true,
                scrollX: true,
                autoWidth: true,
                columns: [
                    {
                        data: null,
                        title: '',
                        width: '10',
                        render: function (data, type, row) {
                            return '<a class="btn-edit-tam-ung" data-id="' + data.id + '" data-mmyy="' + data.mmyy + '"  > <i class="far fa-edit"></i></a>';
                        }
                    },
                    { data: 'lan', title: 'Lần', width: '10px' },
                    { data: 'tenkp', title: 'Khoa Phòng' },
                    { data: 'ngay', title: 'Ngày' },
                    { data: 'doituong', title: 'Đối tượng' },
                    { data: 'ten', title: 'Nội dung' },
                    { data: 'sotien', title: 'Số tiền' },
                ],
                columnDefs:
                    [
                        {
                            targets: 0
                        }
                    ],
            });
            $('#' + obj).on('click', '.btn-edit-tam-ung', function () {
                var row = $(this).closest('tr');
                var rowData = $('#' + obj).DataTable().row(row).data();

                LoadEditTamUng(rowData.id, rowData.mmyy);
            });
        }
        function LoadChiDinhTamUng() {
            $('#loadInputTamUng').html('');
            $('#modalInputTamUng').modal({ backdrop: 'static', keyboard: false });
            $.ajax({
                url: '/ToDieuTri/LoadChiDinhTamUng',
                type: 'POST',
                data: {
                    maBn: $('#hdMabn').val(),
                    maKP: $('#ddlKhoa').val(),
                    maVV: $('#hdMaVV').val(),
                    maQL: $('#hdMaQL').val(),
                    ngayVV: $('#hdNgayVV').val(),
                }
            }).done(function (response) {

                $('#loadInputTamUng').html(response);
                $('#txtTuMaBn').text($('#hdMabn').val());
                $('#txtTuHoTen').text($('#hdHoten').val());
                $('#txtTuNgaySinh').text($('#hdNgaySinh').val());
                $('#txtTuGioiTinh').text($('#hdGioiTinh').val());
                LoadDanhSachTamUng();

                $('.btn-refesh-tamung').click(function () {
                    LoadDanhSachTamUng();
                });
            });
        }

        function LoadDanhSachTamUng() {
            $('#modalInputTamUng').modal({ backdrop: 'static', keyboard: false });
            $.ajax({
                url: '/ToDieuTri/LoadDanhSachTamUng',
                type: 'POST',
                data: {
                    maBn: $('#hdMabn').val(),
                    maKP: $('#ddlKhoa').val(),
                    maVV: $('#hdMaVV').val(),
                    maQL: $('#hdMaQL').val(),
                    ngayVV: $('#hdNgayVV').val(),

                }
            }).done(function (response) {
                IntitControl();
                setTimeout(function () {
                    BuildTableTamUng('tblListTamUng', response.data);
                }, 200);


            });
        }

        function BuildTableChiDinhDichVu(obj, data) {
            $('#' + obj).DataTable({
                ordering: false,
                searching: false,
                paging: true,
                data: data,
                lengthChange: false,
                pagingType: "simple_numbers",
                info: false,
                language: {
                    "lengthMenu": "Hiển thị _MENU_ dòng trên 1 trang",
                    "zeroRecords": "Không có dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ trong _TOTAL_ dòng",
                    "infoEmpty": "Chưa có dữ liêu",
                    "infoFiltered": "(dữ liệu trong  _MAX_ )",
                    "paginate": {
                        "previous": "«", "next": "»"
                    }
                },
                scrollCollapse: true,
                destroy: true,
                scrollX: true,
                autoWidth: true,
                columns: [
                    {
                        data: null,
                        title: '',
                        width: '10',
                        render: function (data, type, row) {

                            return '<a class="btn-del-chidinh" data-id="' + data.id + '" data-id-dienbien="' + data.iddienbien + '" data-id-chidinh="' + data.idchidinh + '" data-mmyy="' + data.mmyy + '"  > <i class="fas fa-trash-alt"></i></a>';
                        }
                    },
                    { data: 'ngay', title: 'Ngày chỉ định' },

                    { data: 'ma', title: 'Mã dịch vụ' },
                    { data: 'ten', title: 'Tên dịch vụ' },
                    { data: 'soluong', title: 'Số lượng' },
                    { data: 'dongia', title: 'Giá' },
                    { data: 'doituong', title: 'Tên đối tượng' },
                    { data: 'tenkp', title: 'Khoa / Phòng' },
                ],
                columnDefs:
                    [
                        {
                            targets: 1,
                            render: function (data, type, row) {
                                let control = moment(row.ngay).format("DD/MM/YYYY HH:mm:ss");
                                return control;
                            }
                        },
                        {
                            targets: 5,
                            render: function (data, type, row) {
                                // Format money here
                                if (type === 'display' || type === 'filter') {
                                    return parseFloat(data).toFixed(2);
                                }
                                return data;
                            }
                        },
                    ],
            });
            $('#' + obj).off('click', '.btn-del-chidinh');
            $('#' + obj).on('click', '.btn-del-chidinh', function () {
                var row = $(this).closest('tr');
                var rowData = $('#' + obj).DataTable().row(row).data();
                console.log(rowData.idchidinh + "--------");

                $.ajax({
                    url: '/ToDieuTri/LoadDelChiDinh',
                    type: 'POST',
                    data: {
                        idchidinh: $(this).attr('data-id'),
                        id: rowData.iddienbien,
                        mmyy: $('#hdDienBienMmyy').val()
                    }
                }).done(function (response) {
                    if (response.isValid == true && response.data == 'true') {
                        toastr.success('Xóa chỉ định thành công');
                        LoadDSChiDinhDichVu();

                    } else {
                        toastr.error('Xóa chỉ định không thành công');
                    }
                });
            });
        }
        //ChamSoc
        function LoadChamSoc() {
            if ($('#hdDienBienID').val() == '0') {
                toastr.error('Vui lòng chọn diễn biến');

            } else {
                $('#loadModalChamSoc').html('');

                $.ajax({
                    url: '/ToDieuTri/LoadChamSoc',
                    type: 'POST',
                    data: {
                        dienBienID: $('#hdDienBienID').val(),
                        mmyy: $('#hdDienBienMmyy').val(),
                    }
                }).done(function (response) {

                    $('#loadModalChamSoc').html(response);

                    $('#txtCSTuMaBn').text($('#hdMabn').val());
                    $('#txtCSTuHoTen').text($('#hdHoten').val());
                    $('#txtCSTuNgaySinh').text($('#hdNgaySinh').val());
                    $('#txtCSTuGioiTinh').text($('#hdGioiTinh').val());

                    $('#modalChamSoc').modal({ backdrop: 'static', keyboard: false });
                });
            }

        }



        //DinhDuong
        function LoadDinhDuong() {
            if ($('#hdDienBienID').val() == '0') {
                toastr.error('Vui lòng chọn diễn biến');

            } else {
                $('#loadModalDinhDuong').html('');

                $.ajax({
                    url: '/ToDieuTri/LoadDinhDuong',
                    type: 'POST',
                    data: {
                        dienBienID: $('#hdDienBienID').val(),
                        mmyy: $('#hdDienBienMmyy').val(),
                        loaibn: $('#hdLoaiBn').val(),
                        mabn: $('#hdMabn').val(),
                        mavaovien: $('#hdMaVV').val(),
                    }
                }).done(function (response) {

                    $('#loadModalDinhDuong').html(response);

                   loadThongTinHanhChinh();

                    $('#modalDinhDuong').modal({ backdrop: 'static', keyboard: false });
                });
            }

        }

        function loadThongTinHanhChinh() {
            $('#txtDinhDuongTuMaBn').text($('#hdMabn').val());
            $('#txtDinhDuongTuHoTen').text($('#hdHoten').val());
            $('#txtDinhDuongTuNgaySinh').text($('#hdNgaySinh').val());
            $('#txtDinhDuongTuGioiTinh').text($('#hdGioiTinh').val());
        }
        //Update DienBien
        function LoadUpdateDienBien() {
            if ($('#hdDienBienID').val() == '0') {
                toastr.error('Vui lòng chọn diễn biến');

            } else {
                $('#LoadUpdateDienBien').html('');

                $.ajax({
                    url: '/ToDieuTri/LoadDienBien',
                    type: 'POST',
                    data: {
                        dienBienID: $('#hdDienBienID').val(),
                        mmyy: $('#hdDienBienMmyy').val(),
                    }
                }).done(function (response) {

                    $('#LoadUpdateDienBien').html(response);

                    $('#txtDBMaBn').text($('#hdMabn').val());
                    $('#txtDBHoTen').text($('#hdHoten').val());
                    $('#txtDBNgaySinh').text($('#hdNgaySinh').val());
                    $('#txtDBGioiTinh').text($('#hdGioiTinh').val());

                    $('#modalUpdateDienBien').modal({ backdrop: 'static', keyboard: false });
                });
            }

        }





        function LoadChiDinhDichVu() {
            $('#loadModalChiDinhDichVu').html('');

            $.ajax({
                url: '/ToDieuTri/LoadChiDinhDichVu',
                type: 'POST',
                data: {
                    maBn: $('#hdMabn').val(),
                    maKP: $('#ddlKhoa').val(),
                    maVV: $('#hdMaVV').val(),
                    maQL: $('#hdMaQL').val(),
                    ngayVV: $('#hdNgayVV').val(),
                }
            }).done(function (response) {

                $('#loadModalChiDinhDichVu').html(response);

                $('#txtDvTuMaBn').text($('#hdMabn').val());
                $('#txtDvTuHoTen').text($('#hdHoten').val());
                $('#txtDvTuNgaySinh').text($('#hdNgaySinh').val());
                $('#txtDvTuGioiTinh').text($('#hdGioiTinh').val());
                LoadDSChiDinhDichVu();
                $('.btn-refesh-dichvu').click(function () {
                    LoadDSChiDinhDichVu();
                });
                $('#modalChiDinhDichVu').modal({ backdrop: 'static', keyboard: false });
            });
        }
        function LoadDSChiDinhDichVu() {
            $.ajax({
                url: '/ToDieuTri/LoadDanhSachChiDinhDichVu',
                type: 'POST',
                data: {
                    mabn: $('#hdMabn').val(),
                    maKP: $('#ddlKhoa').val(),
                    mavaovien: $('#hdMaVV').val(),
                    maql: $('#hdMaQL').val(),
                    tungay: $('#hdNgayVV').val(), iddienbien: $('#hdDienBienID').val(),
                }
            }).done(function (response) {
                IntitControl();
                setTimeout(function () {
                    BuildTableChiDinhDichVu('tblListDichVu', response.data);
                }, 200);


            });
        }
 
        function LoadInputDienBien() {
            $('#loadInputDienBien').html('');

            $.ajax({
                url: '/ToDieuTri/LoadInputDienBien',
                type: 'POST'
            }).done(function (response) {

                $('#loadInputDienBien').html(response);
                $('#txtDvMaBn').text($('#hdMabn').val());
                $('#txtDvHoTen').text($('#hdHoten').val());
                $('#txtDvNgaySinh').text($('#hdNgaySinh').val());
                $('#txtDvGioiTinh').text($('#hdGioiTinh').val());
                $('#modalInputDienBien').modal({ backdrop: 'static', keyboard: false });
            });
        }
        if (ajaxLoadDienBien) {
            ajaxLoadDienBien.abort();
        }
        var ajaxLoadDienBien = null;

        function LoadDSNhomKhoaDienBien() {
            Loading($('#ThongTinHanhChinh'));
         $.ajax({
        url: '/ToDieuTri/LoadDanhSachNhomKhoa',
        type: 'POST',
        data: {
            mabn: $('#hdMabn').val(),
            mavaovien: $('#hdMaVV').val(),
            tungay: $('#DateFrom').val(), //tungay: moment($('#hdNgayVV').val().split(' ')[0],'MM/DD/YYYY').format('DD/MM/YYYY'),// $('#DateFrom').val(),
            denngay: $('#DateTo').val()
        },
        timeout: 60000 // thời gian timeout là 10 giây
    }).done(function (response) {
         $('#LoadDSDienBien').html(response);
            if($('#checkHasData').val()=="1"){
        
                LoadDanhSachDienBienByKhoa(
                    $('[aria-expanded="true"].tab-show-dienbien').attr('data-id'),
                    $('[aria-expanded="true"].tab-show-dienbien').attr('data-mavaovien'),
                    $('[aria-expanded="true"].tab-show-dienbien').attr('data-loaibn'),
                    $('[aria-expanded="true"].tab-show-dienbien').attr('data-makp')
                );
        
        }
               
      RemoveLoading($('#ThongTinHanhChinh'));
    }).fail(function (jqXHR, textStatus, errorThrown) {
             RemoveLoading($('#ThongTinHanhChinh'));
        if (textStatus === "timeout") {
            toastr.error("Vui lòng thử lại sau.");
        } else {
              toastr.error("Đã xảy ra lỗi: " + errorThrown);
        }
            });

        }

        function LoadDSDienBien() {

            LoadDSNhomKhoaDienBien();

        }






        if (ajaxLoadDienBienCC) {
            ajaxLoadDienBienCC.abort();
        }
        var ajaxLoadDienBienCC = null;
        function LoadDSDienBienCapCuu() {
          //  Loading($('#show-capcuu'));
            if (ajaxLoadDienBienCC) {
                ajaxLoadDienBienCC.abort();
            }
            ajaxLoadDienBienCC= $.ajax({
                url: '/ToDieuTri/LoadDanhSachDienBienCapCuu',
                type: 'POST',
                data: {
                    mabn: $('#hdMabn').val(),
                    mavaovien: $('#hdMaVV').val(),
                    tungay: $('#DateFrom').val(),
                    denngay: $('#DateTo').val(),
                    madoituong: $('#hdMaDoiTuong').val(),
                    maql: $('#hdMaQL').val(),
                    idkhoa: $('#hdIDKHOA').val(),
                    makp: $('#hdMAKP').val(),
                    loaibn: 4,
                }
            }).done(function (response) {


                $('#show-capcuu').append(response);
              //  RemoveLoading($('#show-capcuu'));

            });
        }
        function BuildTableDienBien(obj, data) {
            $('#' + obj).DataTable({
                ordering: false,
                searching: false,
                paging: true,
                data: data,
                lengthChange: false,
                pagingType: "simple_numbers",
                info: false,
                language: {
                    "lengthMenu": "Hiển thị _MENU_ dòng trên 1 trang",
                    "zeroRecords": "Không có dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ trong _TOTAL_ dòng",
                    "infoEmpty": "Chưa có dữ liêu",
                    "infoFiltered": "(dữ liệu trong  _MAX_ )",
                    "paginate": {
                        "previous": "«", "next": "»"
                    }
                },
                scrollCollapse: true,
                destroy: true,
                scrollX: true,
                autoWidth: true,
                columns: [

                    { data: 'ngay', title: 'Ngày ' },
                    { data: 'tenkp', title: 'Khoa/Phòng' },
                    { data: 'noidung', title: 'Diễn biến bệnh' },
                    { data: 'ghichu', title: 'Y lệnh' },
                    {
                        data: null,
                        title: 'Thao tác',
                        width: '10px',
                        render: function (data, type, row) {
                            return '<a title="Xác nhận" class="btn-xac-nhan btn btn-sm btn-outline-success mr-1" data-id="' + data.id + '" data-mmyy="' + data.mmyy + '"  > <i class="fas fa-check"></i></a><a title="Ký số" class="btn-ky  btn btn-sm btn-outline-primary mr-1" data-id="' + data.id + '" data-mmyy="' + data.mmyy + '"  > <i class="fas fa-signature"></i></a><a title="Hủy ký" class="btn-cancel  btn btn-sm btn-outline-danger mr-1" data-id="' + data.id + '" data-mmyy="' + data.mmyy + '"  > <i class="fas fa-minus-circle"></i></a>';
                        }
                    },
                ],
                columnDefs:
                    [
                        {
                            targets: 0,
                            render: function (data, type, row) {
                                let control = moment(row.ngay).format("DD/MM/YYYY HH:mm");
                                return control;
                            }
                        },
                    ]
            });
            $('#' + obj).on('click', '.btn-xac-nhan', function () {
                var row = $(this).closest('tr');
                var rowData = $('#' + obj).DataTable().row(row).data();
                toastr.success('Xác nhận thành công');
            });
            $('#' + obj).on('click', '.btn-ky', function () {
                var row = $(this).closest('tr');
                var rowData = $('#' + obj).DataTable().row(row).data();
                toastr.success('Ký thành công');
            });
            $('#' + obj).on('click', '.btn-cancel', function () {
                var row = $(this).closest('tr');
                var rowData = $('#' + obj).DataTable().row(row).data();
                toastr.success('Hủy thành công');
            });
            // Use the RowGroup extension to group and collapse rows

        }


</script>

<script type="text/javascript">
    function mModalLichSuKy(id) {
        return $(`<div class="modal fade" id="m${id}" style="background-color: #80808080;" tabindex="-1"  aria-hidden="true" data-toggle="modal" data-backdrop="static" data-keyboard="false">
                                                            <div class="modal-dialog modal-xxl" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-body customModal_content" style="height:80vh">
                                                                                <div class="row h-100">
                                                                                        <div class="col-12 h-100">
                                                                                                            <div id="${id}" ></div>
                                                                                    </div>

                                                                                </div>

                                                                    </div>
                                                                       <div class="modal-footer justify-content-end">

                                                                                <button type="button" class="btn btn-cancel btn-danger btn-close" >Đóng</button>
                                                                  </div>
                                                                </div>
                                                            </div>
                                                        </div>`);
    }
    function viewSelectLichSuKy() {


        let id = uuidv4();
        let m = mModalLichSuKy(id);
        m.find('.btn-close').on('click',
            function () {
                m.modal('hide');
            });
        m.on('hidden.bs.modal',
            function (e) {

                m.remove();
            });
        m.on('shown.bs.modal',
            function (e) {

                let sProduct = FEFrom(id, "/todieutri/LichSuKy", {
                    query: "?idseq=" + $('#hdDienBienID').val() + "&ngayvv=" + $('#hdNgayVV').val() + "&ngayvv=" + $('#hdNgayVV').val() + "&mavv=" + $('#hdMaVV').val() + "&mabn=" + $('#hdMabn').val(),
                    "listTemplate": "ToDieuTri/LichSuKy/_PopupSelectLichSuKyListFilter"
                });

                sProduct.LoadLayout(function (obj) {

                    $('#' + obj.getID()).css('height', '100%');
                    $('#' + obj.getID() + "_Table").attr('style', "height:calc(" + ($('#' + obj.getID()).height() - $('#' + obj.getID() + ' .Layout_Filter').height()) + "px - 0rem)");
                    $('#' + obj.getID()).find('.freezeTable').css("height", "100%");


                });





            });
        m.modal('show');



    }

    function mModalLichSuDuLieu(id) {
        return $(`<div class="modal fade" id="m${id}" style="background-color: #80808080;" tabindex="-1"  aria-hidden="true" data-toggle="modal" data-backdrop="static" data-keyboard="false">
                                                                <div class="modal-dialog modal-xxl" role="document">
                                                                    <div class="modal-content">
                                                                            <div class="modal-body customModal_content " style="height:80vh">
                                                                                    <div class="row h-100">
                                                                                            <div class="col-12 h-100">
                                                                                                                <div id="${id}"  ></div>
                                                                                        </div>

                                                                                    </div>

                                                                        </div>
                                                                           <div class="modal-footer justify-content-end">

                                                                                    <button type="button" class="btn btn-cancel btn-danger btn-close" >Đóng</button>
                                                                      </div>
                                                                    </div>
                                                                </div>
                                                            </div>`);
    }
    function viewSelectLichSuDuLieu() {


        let id = uuidv4();
        let m = mModalLichSuDuLieu(id);
        m.find('.btn-close').on('click',
            function () {
                m.modal('hide');
            });
        m.on('hidden.bs.modal',
            function (e) {

                m.remove();
            });
        m.on('shown.bs.modal',
            function (e) {

                let sProduct = FEFrom(id, "/todieutri/LichSuDuLieu", {
                    query: "?idseq=" + $('#hdDienBienID').val() + "&ngayvv=" + $('#hdNgayVV').val() + "&mavv=" + $('#hdMaVV').val() + "&mabn=" + $('#hdMabn').val(),
                    "listTemplate": "ToDieuTri/LichSuDuLieu/_PopupSelectLichSuDuLieuListFilter"
                });

                sProduct.LoadLayout(function (obj) {

                    $('#' + obj.getID()).css('height', '100%');
                    $('#' + obj.getID() + "_Table").attr('style', "height:calc(" + ($('#' + obj.getID()).height() - $('#' + obj.getID() + ' .Layout_Filter').height()) + "px - 0rem)");
                    $('#' + obj.getID()).find('.freezeTable').css("height", "100%");


                });





            });
        m.modal('show');



    }

    function mModalDanhMucVietTat(id) {
        return $(`<div class="modal fade" id="m${id}" style="background-color: #80808080;" tabindex="-1"  aria-hidden="true" data-toggle="modal" data-backdrop="static" data-keyboard="false">
                                                                    <div class="modal-dialog modal-xxl" role="document">
                                                                        <div class="modal-content">
                                                                            <div class="modal-body customModal_content" style="height:80vh">
                                                                                        <div class="row h-100">
                                                                                                <div class="col-12 h-100">
                                                                                                                    <div id="${id}" data-template="ToDieuTri/DienBienTemplate/_PopupSelectDienBienTemplate" ></div>
                                                                                            </div>

                                                                                        </div>

                                                                            </div>
                                                                               <div class="modal-footer justify-content-end">

                                                                                        <button type="button" class="btn btn-cancel btn-danger btn-close" >Đóng</button>
                                                                          </div>
                                                                        </div>
                                                                    </div>
                                                                </div>`);
    }
    function viewSelectDanhMucVietTat() {


        let id = uuidv4();
        let m = mModalDanhMucVietTat(id);
        m.find('.btn-close').on('click',
            function () {
                m.modal('hide');
            });
        m.on('hidden.bs.modal',
            function (e) {

                m.remove();
            });
        m.on('shown.bs.modal',
            function (e) {

                let sProduct = FEFrom(id, "/todieutri/DanhMucVietTat", {
                    query: "?mabs=" + $('#MaBacSi').val(),
                    "listTemplate": "ToDieuTri/DanhMucVietTat/_PopupSelectDanhMucVietTatListFilter"
                });

                sProduct.LoadLayout(function (obj) {

                    $('#' + obj.getID()).css('height', '100%');
                    $('#' + obj.getID() + "_Table").attr('style', "height:calc(" + ($('#' + obj.getID()).height() - $('#' + obj.getID() + ' .Layout_Filter').height()) + "px - 0rem)");
                    $('#' + obj.getID()).find('.freezeTable').css("height", "100%");


                });





            });
        m.modal('show');



    }


</script>
<style>
#toast-container{
    z-index:99999999999;
}
</style>
<script src="/js/todieutri/freeze-table.min.js"></script>

        </div>
    </div>
</div>


<style>
    #ThongTinHanhChinh {
        height: calc(100vh - 60px);
    }
    .ajax-form .form-horizontal{
        min-height: 345px;
    }
  
    #dien-bien-list {
        height: calc(100vh - 330px);
        overflow-y: scroll;
    }


    .layout-footer-fixed .wrapper .content-wrapper {
        padding-bottom: calc(3.5rem + -62px);
    }
    /*    .page-link {

            padding: 0px 10px;
        }*/
    .-container--default .-selection--single {
        padding: 0.3rem .75rem;
        height: 38px;
    }


    /* width */
    ::-webkit-scrollbar {
        width: 5px;
        height: 10px
    }

    /* Track */
    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 5px white;
        border-radius: 10px;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: grey;
        border-radius: 10px;
    }

    .ui-autocomplete {
        z-index: 9999 !important;
    }

    .btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
        box-shadow: unset !important;
    }

    .table td, .table th {
        padding: 3px;
    }

    table.dataTable {
        margin-top: -1px !important;
    }

    .input-secondary {
        width: 30px !important;
        border-left: none !important;
    }

    .modal-dialog.modal-xxl {
        width: 90%;
        max-width: unset;
        height: 95vh;
    }
    @media (min-width: 992px) {
        .modal-dialog.modal-xxl {
            width: 98%;
            max-width: unset;
            height: 100vh;
        }
}
</style>


<div class="modal fade" id="modalPhieuDutru" tabindex="-1" role="dialog" aria-labelledby="modalPhieuDutruLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="max-width:800px;">
        <div class="modal-content">
            <div class="modal-header py-1">
                <h5 class="modal-title" id="modalPhieuDutruLabel">Phiếu dự trù</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body " id="loadModalDuTru">
                

<script>
    $('.btn-dutru').click(function () {
        var isVail = true;
        var dropNhom = $('#dropNhom');
        var dropPhieu = $('#dropPhieu');
        var SoNgayNhap = $('#txtSoNgayNhap');

        if (dropNhom.val() == '') {
            isVail = false; dropNhom.addClass('validate');
            toastr.error('Vui lòng chọn nhóm');
            return;

        } else {
            dropNhom.removeClass('validate');
        }
        if (SoNgayNhap.val() == '') {
            isVail = false; SoNgayNhap.addClass('validate');
            toastr.error('Vui nhập Số ngày nhập');
            return;

        } else {
            SoNgayNhap.removeClass('validate');
        }
        if (isVail == true) {
            LoadInputDutru();
        }
        if (dropPhieu.val() == '') {
            isVail = false; dropPhieu.addClass('validate');
            toastr.error('Vui lòng chọn phiếu');
            return;

        } else {
            dropPhieu.removeClass('validate');
        }

    });
    function LoadInputDutru() {

        $.ajax({
            url: '/ToDieuTri/LoadInputDutru',
            type: 'POST',
            data: {
                Loai: $('#dropLoai').val(),
                Ngay: $('#dtTuNgay').val(),
                SoThang: $('#txtThang').val(),
                Nam: $('#txtNam').val(),
                SoNgayNhap: $('#txtSoNgayNhap').val(),
                Phieu: $('#dropPhieu').val(),
                TuTruc: $('#dropTuTruc').val(),
                Nhom: $('#dropNhom').val()
            }
        }).done(function (response) {
            $('form#DuTru')[0].reset();
            $('#modalPhieuDutru').modal('hide');
            $('#modalInputDutru').modal({ backdrop: 'static', keyboard: false });
            $('#loadInputDutru').html(response);

        });

    }
</script>
            </div>

        </div>
    </div>
</div>
<div class="modal fade" id="modalTuTruc" tabindex="-1" role="dialog" aria-labelledby="modalPhieuTuTrucLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document" style="max-width:800px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalPhieuTuTrucLabel">Xuất tủ trực</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body loadModalTuTruc">
                <form class="form-horizontal">
    <div class="card-body">
        <div class="form-group row mb-1">
            <label for="dropLoai" class="col-lg-2 col-form-label">Loại</label>
            <div class="col-lg-10">
                <select class="form-control form-control-sm" id="dropLoai" style="width: 100%;">
                    <option selected="selected">Phiếu dự trù</option>
                    <option>Phiếu xuất tủ trực</option>
                    <option>Phiếu hoàn trả</option>
                    <option>Phiếu hao phí</option>
                </select>
            </div>
        </div>
        <div class="form-group row mb-1">
            <label for="txtNgay" class="col-lg-2 col-form-label">Ngày</label>
            <div class="col-lg-3">

                <div class="input-group input-group-sm date datePickerField" id="resdate-dtTuNgay" data-target-input="nearest">
                    <input type="text" id="dtTuNgay" name="tuNgay" class="form-control datetimepicker-input" data-target="#resdate-dtTuNgay" />
                    <div class="input-group-append" data-target="#resdate-dtTuNgay" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                </div>
            </div>
            <label for="txtThang" class="col-lg-2 col-form-label">Số liệu tháng</label>
            <div class="col-lg-2">
                <input type="number" id="txtThang" max="31" min="0" maxlength="2" class="form-control form-control-sm" />
            </div>
            <label for="txtNam" class="col-lg-1 col-form-label">Năm</label>
            <div class="col-lg-2">
                <input type="number" id="txtNam" maxlength="4" min="0" class="form-control form-control-sm" />
            </div>
        </div>
        <div class="form-group row mb-1">
            <label for="dropNhom" class="col-lg-2 col-form-label">Nhóm</label>
            <div class="col-lg-3">
                <select class="form-control form-control-sm" id="dropNhom" style="width: 100%;">
                    <option selected="selected">Khoa dược</option>

                </select>
            </div>
            <label for="txtSoNgayNhap" class="col-lg-2 col-form-label">Số ngày nhập</label>
            <div class="col-lg-5">
                <input type="number" id="txtSoNgayNhap" min="0" class="form-control form-control-sm" />
            </div>


        </div>
        <div class="form-group row mb-1">
            <label for="dropPhieu" class="col-lg-2 col-form-label">Phiếu</label>
            <div class="col-lg-10">

                <div class="input-group">
                    <select class="form-control form-control-sm" id="dropPhieu" style="width: 85%;">
                    </select>
                    <span class="input-group-append" style="width: 15%;">
                        <button type="button" class="btn btn-info btn-flat w-100">Tất cả</button>
                    </span>
                </div>
            </div>



        </div>
        <div class="form-group row mb-1">
            <label for="dropTuTruc" class="col-lg-2 col-form-label">Tủ trực</label>
            <div class="col-lg-10">

                <select class="form-control form-control-sm" id="dropTuTruc" style="width: 100%;">
                </select>
            </div>



        </div>
    </div>

    <div class="px-3">
        <button type="button" class="btn btn-primary">Đồng ý</button>
        <button type="button" class="btn btn-sm btn-default float-right" data-dismiss="modal" aria-label="Close">Hủy</button>
    </div>

</form>
            </div>

        </div>
    </div>
</div>





<div class="modal fade" id="modalInputDutru" tabindex="-1" role="dialog" aria-labelledby="modalInputDutruLabel" aria-hidden="true">
    <div class="modal-dialog modal-xxl" role="document">
        <div class="modal-content">
            <div class="modal-header py-1">
                <h5 class="modal-title" id="modalInputDutruLabel">Dự trù khoa dược theo người bệnh</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body " id="loadInputDutru">
                <form class="form-horizontal">
    <div class="card-body p-0">
        <div class="form-group row mb-1">
            <div class="col-lg-2">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Mã BN</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtMabn" placeholder="Mã BN">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Họ tên</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtHoTen" placeholder="Họ tên">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Bác sỹ</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" style="width:8%;" id="txtMaBacSy">
                    <input type="text" id="txtTenBacSy" style="width:55%;" class="form-control form-control-sm" />
                </div>
            </div>
            <div class="col-lg-4">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">ĐDV</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" style="width:8%;" id="txtMaBacSy">
                    <input type="text" id="txtTenBacSy" style="width:55%;" class="form-control form-control-sm" />
                </div>
            </div>
        </div>
        <div class="form-group row mb-1">
            <div class="col-lg-2">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Phòng</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtPhong" placeholder="Phòng">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Giường</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtGiuong" placeholder="Giường">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Số ngày</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" style="width:10%;" id="txtSoNgay">
                    Ngày
                </div>
            </div>
            <div class="col-lg-4">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Ghi chú</span>
                    </div>
                    <input type="text" id="txtGhiChu" style="width:75%;" class="form-control form-control-sm" />
                </div>
            </div>
        </div>
        <div class="form-group row mb-1">
            <div class="col-lg-2">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Chẩn đoán</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtChanDoan" placeholder="Chẩn đoán">
                </div>
            </div>
            <div class="col-lg-10">
                <div class="input-group mb-3 input-group-sm">
                    <input type="text" class="form-control form-control-sm" id="txtMotaChuanDoan">
                </div>
            </div>
           
         
        </div>
        <div class="form-group row mb-1">
            <div class="col-lg-2">
                <div class="input-group mb-3 input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Phiếu</span>
                    </div>
                    <input type="text" class="form-control form-control-sm" id="txtTimKiemPhieu" placeholder="Tìm kiếm">
                </div>
            </div>
            <div class="col-lg-10">
                <div class="input-group mb-3 input-group-sm">
                    <input type="text" class="form-control form-control-sm" id="txtMotaPhieu">
                </div>
            </div>


        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">

                </div>
            </div>
        </div>

    </div>

    <div>
        <button type="button" class="btn btn-sm btn-primary btn-dutru">Đồng ý</button>
        <button type="button" class="btn btn-sm btn-default float-right">Hủy</button>
    </div>

</form>

            </div>

        </div>
    </div>
</div>

<div id="loadInputTamUng">
</div>
<div id="loadModalChamSoc">
</div>
<div id="loadModalDinhDuong">
</div>
<div id="loadModalChiDinhDichVu">
</div>
<div id="loadInputDienBien">
</div>

<div id="LoadChiTietDienBien">
</div>
<div id="LoadUpdateDienBien">
</div>
<style>
   

  

    .select2-container--default .select2-results__option {
        padding: 0px 5px;
        font-size: 14px;
        line-height: 18px;
    }

    select.form-control-sm ~ .select2-container--default {
        font-size: 100%;
    }

        .text-sm .select2-container--default .select2-selection--single, select.form-control-sm ~ .select2-container--default .select2-selection--single {
            height: calc(1.8125rem + 2px) !important;
        }

    .select2-container--default .select2-selection--single {
        background-color: #fff;
        border: 1px solid #ced4da;
        /* border-radius: 0px; */
    }

    .field-validation-valid {
        color: red;
    }

    .customModal .modal-header {
        padding: 5px 1rem;
    }

    .loading {
        position: relative
    }

        .loading div.opacity {
            display: block !important;
        }

        .loading div.loading_icon {
            display: block !important;
        }
    .select2-container {
        z-index: 9999999999!important;
    }
</style>
<link href="/css/ttthongbao.css" rel="stylesheet" />
<script src="/js/todieutri/todieutricontroller.js"></script>
<script type="text/javascript" src="/js/ttthongbao.js"></script>


<style>
    .duplicate-row {
        background-color: rgba(220,53,69,0.5) !important;
    }

    .co-tdt {
        font-weight: bold !important;
    }

    .co-tienme {
        font-style: italic !important;
        background-color: rgba(53,158,220,0.5) !important;
    }

    .card.card-sm.card-primary.card-header {
        padding: 5px;
    }

    table tbody > tr > td {
        vertical-align: middle !important;
    }

    .freezeTable-Scroll {
        max-height: 445px !important;
    }

    .select2-container {
        z-index: 999999999;
    }
</style>

                </div>

            </main>
        </div>
    </div>
    <div class="main-footer">
        <div class="float-right d-none d-sm-block">
            <b>Tam Anh Hospital</b>
        </div>
        <strong>&nbsp;</strong>
    </div>
    <!-- /.content-wrapper -->



    

    <script>

        $('#cbTaCa').change(function () {
            if ($(this).is(':checked')) {
                $('#hdcbTaCa').val(1);
            } else {
                $('#hdcbTaCa').val(0);
            }
            LoadData($("#form"));
        });
        function getUrlVars() {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        if (getUrlVars().type != undefined) {
            $('#hdLoaiBn').val(getUrlVars().type);
        }
        if (getUrlVars().mabn != undefined) {
            LoadDetail(getUrlVars().mabn, $('#hdLoaiBn').val());
            GetPatient(getUrlVars().mabn);
        }
       
        $('#ddlKhoa').on('change', function () {
            LoadData($("#form"));

        });

        LoadPhieu('');
        LoadNhomKho('');
        LoadKhoaPhong();

        function GetPatient(mabn) {

            $.ajax({
                url: '/ToDieuTri/GetPatient',
                type: 'POST',
                data: { code: mabn }
            }).done(function (response) {
            });
        }


        function LoadDutru(type) {
            console.log(type);
            $.ajax({
                url: '/ToDieuTri/LoadDutru',
                type: 'POST',
                data: {
                    benhnhan: $('#hdMabn').val(),
                    MaKP: $('#ddlKhoa').val()
                }
            }).done(function (response) {
                $('#modalPhieuDutru').modal({ backdrop: 'static', keyboard: false });
                $('#loadModalDuTru').html(response);
                $('#txtMaKP').val($('#ddlKhoa').val());
                $('#dropLoai').val(type);
                IntitControl();
            });

        }
        //if (ajaxLoadDetail) {
        //    ajaxLoadDetail.abort();
        //}
        var ajaxLoadDetail = null;
        function LoadDetail(mabn, loaibn ) {
            if (ajaxLoadDetail) {
                ajaxLoadDetail.abort();
            }
            ajaxLoadDetail= $.ajax({
                url: '/ToDieuTri/LoadDetail',
                type: 'POST',
                data: { code: mabn, loaibn: loaibn }
            }).done(function (response) {

                $('#DanhSachBenhNhan').hide();
                $('#LoadDetail').html(response);
                $('#ThongTinHanhChinh').show();
                //LoadDSDienBien();
                search_receive_message(false);
                LoadDSNhomKhoaDienBien();
              

            });
        }
        function LoadToDieuTri(mabn) {

            $.ajax({
                url: '/ToDieuTri/LoadToDieuTri',
                type: 'POST',
                data: { code: mabn }
            }).done(function (response) {
                $('#LoadToDieuTri').html(response);

            });
        }
        function LoadKhoaPhong() {

            //$.ajax({
            //    url: '/ToDieuTri/ListKhoaPhong',
            //    type: 'POST',
            //}).done(function (response) {

            //    var drop = '<option value="">Chọn Khoa</option>';
            //    $.each(response.data, function (i, o) {
            //        drop += '<option value="' + o.makp + '">' + o.tenkp + '</option>';
            //    });
            //    $('#ddlKhoa').html(drop);
            //    IntitControl();
            //    $('#ddlKhoa').change(function () {

            //        LoadRoom($(this).val());

            //    });
            //});
        }
        function Loading(cl) {
            RemoveLoading(cl);
            if (!$(cl).hasClass('loading')) {
                $(cl).append(
                    '<div class="loading_icon" style="position: absolute; z-index: 9999999999; left: 50%;transform: translate(-50px,-50px); top: 50%; margin-top: -25px; display: none"><svg width="50px" height="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-reload"><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><g transform="rotate(11.9999 50 50)"><path d="M50 15A35 35 0 1 0 74.787 25.213" fill="none" stroke="#232c9d" stroke-width="12px"></path><path d="M50 0L50 30L66 15L50 0" fill="#232c9d"></path><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="1s" repeatCount="indefinite"></animateTransform></g></svg></div><div class="opacity" style="left: 0px; top: 0px; right: 0px; bottom: 0px; position: absolute; background-color: #f4f4f4; opacity: 0.5; z-index: 10; display: none"></div>');
                $(cl).addClass('loading');
            }
        }

        function RemoveLoading(cl) {
            $(cl).removeClass('loading');
            $(cl).find('.loading_icon').remove();
        }
        $('#ddlKhoa').change(function () {

            LoadRoom($(this).val());

        });
        function LoadPhieu(nhom) {

            $.ajax({
                url: '/ToDieuTri/ListPhieu',
                type: 'POST',
                data: { nhom: nhom }
            }).done(function (response) {
                var drop = '<option value="">Chọn phiếu</option>';
                $.each(response.data, function (i, o) {
                    drop += '<option value="' + o.id + '">' + o.ten + '</option>';
                });
                $('#dropPhieu').html(drop);
                IntitControl();
            });
        }
        function LoadNhomKho(nhom) {

            $.ajax({
                url: '/ToDieuTri/ListNhomKho',
                type: 'POST',
                data: { nhom: nhom }
            }).done(function (response) {
                var drop = '<option value="">Chọn nhóm</option>';
                $.each(response.data, function (i, o) {
                    drop += '<option value="' + o.id + '">' + o.ten + '</option>';
                });
                $('#dropNhom').html(drop);
                IntitControl();
            });
        }
        function LoadRoom(maRoom) {

            $.ajax({
                url: '/ToDieuTri/LoadRoom',
                type: 'POST',
                data: { code: maRoom }
            }).done(function (response) {
                var drop = '<option value="">Chọn phòng</option>';
                $.each(response.data, function (i, o) {
                    drop += '<option value="' + o.id + '">' + o.name + '</option>';
                });
                $('#ddlRoom').html(drop);
                IntitControl();
            });
        }
        function LoadKhoaPhong() {

            $.ajax({
                url: '/ToDieuTri/LoadKhoaPhong',
                type: 'POST',
                data: { loaibn: $('#hdLoaiBn').val(), makp: $('#ddlKhoa').val()  }
            }).done(function (response) {
                var drop = '<option value="">Chọn khoa</option>';
                if($('#hdLoaiBn').val()=='4'){
                    drop = '';
                }
             
                $.each(response.data, function (i, o) {
                    drop += '<option value="' + o.id + '">' + o.name + '</option>';
                });
                $('#ddlKhoa').html(drop);
                IntitControl();
            });
        }

        function LoadTuTruc(ma) {

            $.ajax({
                url: '/ToDieuTri/ListTuTruc',
                type: 'POST',
                data: { ma: ma }
            }).done(function (response) {
                var drop = '<option value="">Chọn tủ trực</option>';
                $.each(response.data, function (i, o) {
                    drop += '<option value="' + o.ma + '">' + o.ten + '</option>';
                });
                $('#dropTuTruc').html(drop); IntitControl();
            });
        }

        function LoadInputTamUng() {

            $.ajax({
                url: '/ToDieuTri/LoadInputTamUng',
                type: 'POST',
                data: {
                    Loai: $('#dropLoai').val(),
                    Ngay: $('#dtTuNgay').val(),
                    SoThang: $('#txtThang').val(),
                    Nam: $('#txtNam').val(),
                    SoNgayNhap: $('#txtSoNgayNhap').val(),
                    Phieu: $('#dropPhieu').val(),
                    TuTruc: $('#dropTuTruc').val(),
                    Nhom: $('#dropNhom').val()
                }
            }).done(function (response) {
                $('form#TamUng')[0].reset();
                $('#modalPhieuTamUng').modal('hide');
                $('#modalInputTamUng').modal({ backdrop: 'static', keyboard: false });
                $('#loadInputTamUng').html(response);

            });

        }
        function IntitControl() {
            $('.select2').each(function () {
                if ($(this).parents('.modal').length > 0) {
                    $(this).select2({
                        language: "vi",
                        allowClear: false, // This is for clear get the clear button if wanted
                        dropdownParent: "#" + $(this).parents('.modal').eq(0).attr('id')
                    });
                } else {
                    $(this).select2({
                        language: "vi",
                        allowClear: false, // This is for clear get the clear button if wanted
                        //dropdownParent: "#form"
                    });
                }


            });

        }
    </script>

    <script>


        $(document).ready(function () {

            LoadData($("#form"));
            $('div[class~="fixedElement"]').remove();

            $('#tblListData').DataTable({
                ordering: false,
                searching: false,
                paging: true,
                pageLength: 20,
                lengthChange: false,
                pagingType: "simple_numbers",
                info: false,
                language: {
                    "lengthMenu": "Hiển thị _MENU_ dòng trên 1 trang",
                    "zeroRecords": "Không có dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ trong _TOTAL_ dòng",
                    "infoEmpty": "Chưa có dữ liêu",
                    "infoFiltered": "(dữ liệu trong  _MAX_ )",
                    "paginate": {
                        "previous": "«", "next": "»"
                    }
                },
                scrollCollapse: true,
                destroy: true,
                scrollX: true,
                autoWidth: true,
                columns: [
                    { data: null, title: 'Stt', width: '20px' },
                    { data: 'doituong', title: 'Đối tượng', width: '100px' },
                    { data: 'mabn', title: 'Mã BN', width: '140px' },
                    { data: 'hoten', title: 'Họ và tên' },
                    { data: 'gioitinh', title: 'Giới tính', width: '100px' },
                    { data: 'ngaysinh', title: 'Ngày sinh', width: '100px' },
                    { data: 'chandoanvk', title: 'Chẩn đoán', width: '400px' },
                    { data: 'ngayvk', title: 'Ngày', width: '100px' },
                    { data: 'tenkhoachuyen', title: 'Nơi chuyển', width: '100px' },
                    { data: 'sothe', title: 'Số thẻ', width: '100px' },
                    { data: 'teN_PHONG', title: 'Tên phòng', width: '100px' },
                    { data: 'teN_GIUONG', title: 'Tên giường', width: '100px' },
                    { data: 'diachi', title: 'Địa chỉ', width: '100px' },
                    { data: 'maicdvk', title: 'Mã ICD', width: '100px' },
                    { data: 'tenbs', title: 'Bác sỹ', width: '100px' },
                    { data: 'ngaydt', title: 'Ngày điều trị', width: '100px' },
                    { data: 'cccd', title: 'Số CCCD', width: '100px' },
                    { data: 'dienthoai', title: 'Điện thoại', width: '100px' },
                ],
                //columnDefs: [
                //    { targets: [0, 1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], orderable: false }, // Disable sorting for all columns except for 'ngayvk'
                //    { targets: 7, orderable: true } // Enable sorting only for 'ngayvk' column
                //],
            });
            $("#btnsearch").click(function () {
                LoadData($("#form"));
            });
        });

        function BuildTable(obj, data) {
            $('#' + obj).DataTable({
                ordering: false,
                searching: false,
                paging: true,
                pageLength: 20,
                data: data,
                lengthChange: false,
                pagingType: "simple_numbers",
                info: false,
                language: {
                    "lengthMenu": "Hiển thị _MENU_ dòng trên 1 trang",
                    "zeroRecords": "Không có dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ trong _TOTAL_ dòng",
                    "infoEmpty": "Chưa có dữ liêu",
                    "infoFiltered": "(dữ liệu trong  _MAX_ )",
                    "paginate": {
                        "previous": "«", "next": "»"
                    }
                },
                scrollCollapse: true,
                destroy: true,
                scrollX: true,
                autoWidth: true,
                columns: [
                    { data: null, title: 'Stt', width: '20px' },
                    { data: 'doituong', title: 'Đối tượng', width: '100px' },
                    { data: 'mabn', title: 'Mã PID', width: '140px' },
                    { data: 'hoten', title: 'Họ và tên' },
                    { data: 'gioitinh', title: 'Giới tính', width: '100px' },
                    { data: 'ngaysinh', title: 'Ngày sinh', width: '100px' },
                    { data: 'chandoanvk', title: 'Chẩn đoán', width: '400px' },
                    { data: 'ngayvk', title: 'Ngày', width: '100px' },
                    { data: 'tenkhoachuyen', title: 'Nơi chuyển', width: '100px' },
                    { data: 'sothe', title: 'Số thẻ', width: '100px' },
                    { data: 'teN_PHONG', title: 'Tên phòng', width: '100px' },
                    { data: 'teN_GIUONG', title: 'Tên giường', width: '100px' },
                    { data: 'diachi', title: 'Địa chỉ', width: '100px' },
                    { data: 'maicdvk', title: 'Mã ICD', width: '100px' },
                    { data: 'tenbs', title: 'Bác sỹ', width: '100px' },
                    { data: 'ngaydt', title: 'Ngày điều trị', width: '100px' },
                    { data: 'cccd', title: 'Số CCCD', width: '100px' },
                    { data: 'dienthoai', title: 'Điện thoại', width: '100px' },
                ],
                columnDefs:
                    [
                        {
                            targets: 0,
                            render: function (data, type, row, meta) {
                                return meta.row + 1;
                            }
                        }
                        ,
                        {
                            responsivePriority: 1, targets: 5, render: function (data, type, row) {
                                if (row.ngaysinh) {
                                    let control = moment(row.ngaysinh).format("DD/MM/YYYY");
                                    return control;
                                } else {
                                    return '';
                                }
                            }
                        },
                        {
                            responsivePriority: 1,
                            targets: 17,
                            render: function (data, type, row) {
                                if (type === 'display' && typeof data === 'string' && data.length === 10) {
                                    let formattedNumber = data.substr(0, 3) + '****' + data.substr(7, 3);
                                    return formattedNumber;
                                } else {
                                    return data;
                                }
                            }
                        },
                           //{ targets: [0, 1, 2, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], orderable: false }, // Disable sorting for all columns except for 'ngayvk'
                           // { targets: 7, orderable: true } // Enable sorting only for 'ngayvk' column
                               
                    ],
                order: [[7, 'desc']]
            });

        }

        function LoadData(form) {
          
            try {
                function hasDuplicates(array) {
                    return (new Set(array)).size !== array.length;
                }
                $.ajax({
                    type: 'POST',
                    url: "/ToDieuTri/Search",
                    data: new FormData(form[0]),
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        if (res.isValid == true) {


                            $.each(res.dataThongKe, function (i, o) {
                                if (o.name == "Hiện Diện") {
                                    $('#countHienDien').html(o.count);
                                }
                                else if (o.name == "Nhập Khoa") {
                                    $('#countNhapKhoa').html(o.count);
                                }
                                else if (o.name == "Xuất Viện") {
                                    $('#countXuatVien').html(o.count);
                                }
                                else if (o.name == "Chuyển khoa") {
                                    $('#countChuyenKhoa').html(o.count);
                                }
                                else if (o.name == "Đã khám") {
                                    $('#countDaKham').html(o.count);
                                }
                                else if (o.name == "Chưa khám") {
                                    $('#countChuaKham').html(o.count);
                                }

                            });
                            BuildTable('tblListData', res.data);
                            let table = $('#tblListData').DataTable();
                            var datacheck = table.rows().data().toArray();


                            // Tô màu các dòng có todieutri
                            var tdtValues = datacheck.map(function (a) {
                                return a.todieutri;
                            });
                            for (var i = 0; i < tdtValues.length; i++) {
                                var value = tdtValues[i];
                                if (value == '1') {
                                    table.row(i).nodes().to$().addClass('co-tdt');
                                }

                            }


                            // Tô màu các dòng có tienme
                            var tmValues = datacheck.map(function (a) {
                                return a.istienme;
                            });
                            for (var i = 0; i < tmValues.length; i++) {
                                var value = tmValues[i];
                                if (value == '1') {
                                    table.row(i).nodes().to$().addClass('co-tienme');
                                }

                            }



                            var mabnValues = datacheck.map(function (a) {
                                return a.hoten;
                            });





                            // Tạo một đối tượng để theo dõi số lần xuất hiện của mỗi giá trị
                            var valueCounts = {};

                            // Lặp qua mảng mabnValues để đếm số lần xuất hiện của mỗi giá trị
                            for (var i = 0; i < mabnValues.length; i++) {
                                var value = mabnValues[i];
                                if (valueCounts[value]) {
                                    valueCounts[value].push(i);
                                } else {
                                    valueCounts[value] = [i];
                                }
                            }

                            // Tô màu các dòng có giá trị giống nhau
                            for (var value in valueCounts) {
                                if (valueCounts[value].length > 1) {
                                    valueCounts[value].forEach(function (rowIndex) {
                                        table.row(rowIndex).nodes().to$().addClass('duplicate-row');
                                    });
                                }
                            }


                             $('table[id="tblListData"] tbody').off('click');
                            $('table[id="tblListData"] tbody').on('click', 'tr', function () {
                                if (!$(this).find('td').hasClass('dataTables_empty')) {
                                    $('table[id="tblListData"] tbody tr.selected').removeClass('selected bg-primary');
                                    $(this).addClass('selected bg-primary');
                                    var data = table.row(this).data();
                                    if (data != null) {

                                        var path = window.location.pathname;
                                        var queryString = window.location.search;
                                        var urlParams = new URLSearchParams(queryString);
                                        urlParams.set('mabn', data.mabn);
                                        var newUrl = path + '?' + urlParams.toString();
                                        window.history.pushState(null, '', newUrl);

                                        LoadDetail(data.mabn, $('#hdLoaiBn').val());
                                        GetPatient(data.mabn);



                                    }


                                }
                                else {

                                }
                            });
                        }
                        else {
                            showMessage(res.message, "error");
                        }
                    },
                    error: function (err) {
                        console.log(err);
                    }
                })
            } catch (ex) {
                console.log(ex)
            }
        }
    </script>

    <script>
        $(document).on('select2:open', () => {
            document.querySelector('.select2-search__field').focus();
        });
        function mModalProduct(id) {
            return $(`<div class="modal fade" id="m${id}" style="background-color: #80808080;" tabindex="-1"  aria-hidden="true" data-toggle="modal" data-backdrop="static" data-keyboard="false">
                            <div class="modal-dialog modal-xxl" role="document">
                                <div class="modal-content">
                                    <div class="modal-body customModal_content" style="height:80vh">
                                                <div class="row h-100">
                                                    <div class="col-12 h-100">
                                                            <div id="${id}"></div>
                                                    </div>

                                                </div>

                                    </div>
                                       <div class="modal-footer justify-content-end">

                                                <button type="button" class="btn btn-cancel btn-danger btn-close" >Đóng</button>
                                  </div>
                                </div>
                            </div>
                        </div>`);
        }
        function uuidv4() {
            return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }
        function showModalDienBien() {



            let id = uuidv4();
            let m = mModalProduct(id);
            m.find('.btn-close').on('click',
                function () {
                    m.modal('hide');
                });
            m.on('hidden.bs.modal',
                function (e) {

                    m.remove();
                });
            m.on('shown.bs.modal',
                function (e) {


                    let sProduct = FEFrom(id, "/todieutri/dienbien", {});

                    sProduct.LoadLayout(function (obj) {

                        // $('#' + obj.getID()).css('height', '100%');
                        // $('#' + obj.getID() + "_Table").attr('style', "height:calc(" + ($('#' + obj.getID()).height() - $('#' + obj.getID() + ' .Layout_Filter').height()) + "px - 0rem)");
                        //  $('#' + obj.getID()).find('.freezeTable').css("height", "100%");


                    });



                    sProduct.AddEvent("BuildFilter", function (el, obj) {

                        /*$('[name$=".SanPham_Id"]').each(function() {
                            ids.push(this.value);
                        });*/
                        /*obj.AdvanceFilters.push(
                            {
                                FilterEnable: true,
                                FilterProperty: "Id",
                                FilterType: "NOT_IN",
                                FilterBy: ids.join(',')
                            });
                        obj.AdvanceFilters.push(
                            {
                                FilterEnable: true,
                                FilterProperty: "NhomHang_Id",
                                FilterType: "",
                                FilterBy: NhomHang_Id
                            });
                            */
                    });



                });
            m.modal('show');

        }
        $('input[name="mabn"]').keypress(function (e) {
            var key = e.which;
            if (key == 13) // the enter key code
            {
                $('#btnsearch').click();
                return false;
            }
        });
    </script>



    <style>
        .content-wrapper {
            min-height: auto !important;
        }
    </style>

    <div class="modal" tabindex="-1" role="dialog" id="loading-modal" >
        <div class="modal-dialog" role="document">
            <div class="md-col-12 row">
                <i class="fa fa-sync fa-spin" style="color: #000; font-size: 30px; top: 50%; position: fixed; right: 50%;"></i>
            </div>
        </div>
    </div>


    <div id="iframe-modal" class="modal text-center" style="z-index: 3050;">
        <iframe id="pdf-iframe" height="100%" width="70%" src=""></iframe>
    </div>

    <script>
        function Toast(header, mess, icon) {

            $.toast({
                heading: header,
                text: mess,
                showHideTransition: 'slide',
                icon: icon,
                position: 'top-right'
            });
        }
    </script>

    <style>

        .card .card-header {
            padding: 5px 10px;
        }

        .card.card-sm .card-body {
            padding: 0.75rem;
        }

        .col-form-label.control-label-sm {
            padding-top: calc(0.25rem + 1px);
            padding-bottom: calc(0.25rem + 1px);
        }

        .form-group.form-group-sm {
            margin-bottom: 0.25rem;
        }

        .table.table-sm {
            margin-bottom: 0.25rem;
        }
    </style>
</body>
</html>